@page
@model DiffModel
@using System.Web
@{
    ViewData["Title"] = "Diff";
}

<link rel="stylesheet" href="~/css/annotated.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/html.css" asp-append-version="true" />

<div class="container">
    <form method="POST">
        <fieldset>
            <legend>Search</legend>
            @{
                if(Model.ErrorMessages!=null && Model.ErrorMessages.Any()){
                    <div class="alert alert-danger">
                        @foreach (var item in Model.ErrorMessages)
                        {
                            <p>
                                - @item
                            </p>
                        }
                    </div>
                }       
            }
            <div class="form-group">
                <label for="object-id">Object ID</label>
                <input 
                    asp-for="RequestModel.ObjectId"
                    class="form-control" 
                    type="text" 
                    placeholder="guid id" 
                    id="object-id" 
                    name="ObjectId" 
                    required/>   
            </div>
            <div class="form-group">
                <label>&nbsp;</label>
                <input type="submit" value="Submit" class="submit" />
            </div>
        </fieldset>
    </form>
</div>
<div id="visual--1"></div>
@{
    for (int i = 0; i < Model.AuditObjects.Count(); i++)
    {
        <div id="visual-@(i)"></div>
    }
}

<script src="~/js/jsondiffpatch.umd.min.js" asp-append-version="true"></script>
<script>


    let diff = [];

    @if(Model.Changes!=null && Model.Changes.Any()){
        foreach (var change in Model.Changes)
        {
            @:diff.push(JSON.parse('@Html.Raw(HttpUtility.JavaScriptStringEncode(change))'));
        }
    }

    let left = [];

    @if(Model.AuditObjects!=null && Model.AuditObjects.Any()){
        foreach (var auditObject in Model.AuditObjects)
        {
            @:left.push(JSON.parse('@Html.Raw(HttpUtility.JavaScriptStringEncode(auditObject.Body.ToString()))'));
        }
    }

    console.log(left);
    console.log(diff);

    if(left.length>0 && diff.length>0){
        document.getElementById(`visual-${-1}`).innerHTML = jsondiffpatch.formatters.html.format([left[0]], left[0]);
        left.forEach((item,i)=>{
            document.getElementById(`visual-${i}`).innerHTML = jsondiffpatch.formatters.html.format(diff[i], item);
        })
    }

    //let left = { a: 3, b: 4 };
    //let right = { a: 5, c: 9 };
    //let delta = jsondiffpatch.diff(left, right);

    // beautiful html diff

    
</script>

